<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Integration Test</title>
</head>
<body>
    <h1>Search Integration Test</h1>
    <button onclick="testFullSearch()">Test Full Search Function</button>
    <div id="status"></div>
    <div id="errors" style="color: red;"></div>

    <script>
        // Import the app.js to test the actual search function
        var script = document.createElement('script');
        script.src = '/app.js';
        script.onload = function() {
            document.getElementById('status').innerHTML = 'app.js loaded successfully';
            
            // Set required globals
            window.selectedStoreId = '70100154';
            console.log('Test ready. selectedStoreId set to:', selectedStoreId);
        };
        script.onerror = function() {
            document.getElementById('errors').innerHTML = 'Failed to load app.js';
        };
        document.head.appendChild(script);

        async function testFullSearch() {
            const statusDiv = document.getElementById('status');
            const errorsDiv = document.getElementById('errors');
            
            try {
                statusDiv.innerHTML = 'Creating mock DOM elements...';
                
                // Create mock DOM elements needed by searchProducts
                if (!document.getElementById('searchTerm')) {
                    const input = document.createElement('input');
                    input.id = 'searchTerm';
                    input.value = 'milk';
                    document.body.appendChild(input);
                }
                
                if (!document.getElementById('searchResults')) {
                    const div = document.createElement('div');
                    div.id = 'searchResults';
                    document.body.appendChild(div);
                }
                
                if (!document.getElementById('tableResults')) {
                    const div = document.createElement('div');
                    div.id = 'tableResults';
                    document.body.appendChild(div);
                }
                
                statusDiv.innerHTML = 'Calling searchProducts()...';
                
                // Call the actual search function
                await window.searchProducts();
                
                statusDiv.innerHTML = 'Search completed! Check console for details.';
                
            } catch (error) {
                console.error('Test error:', error);
                errorsDiv.innerHTML = `Error: ${error.message}<br>Stack: ${error.stack}`;
            }
        }
    </script>
</body>
</html>