<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Filter Testing - Kroger Shopping AI</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            border: 1px solid #ddd;
            margin: 20px 0;
            padding: 20px;
            background: #f9f9f9;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .pass { background: #d4edda; color: #155724; }
        .fail { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover { background: #0056b3; }
        .current-state {
            background: #fff3cd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>üß™ Kroger Shopping AI - Filter Testing Suite</h1>
    
    <div class="current-state">
        <h3>Current State</h3>
        <p><strong>All Products Count:</strong> <span id="allProductsCount">0</span></p>
        <p><strong>Current Products Count:</strong> <span id="currentProductsCount">0</span></p>
        <p><strong>Active Category Filters:</strong> <span id="activeCategoryFilters">None</span></p>
        <p><strong>Active Quick Filters:</strong> <span id="activeQuickFilters">None</span></p>
    </div>

    <div class="test-section">
        <h2>üîß Setup Test Data</h2>
        <button onclick="setupTestData()">Create Test Product Data</button>
        <div id="setupResult"></div>
    </div>

    <div class="test-section">
        <h2>üí∞ Price Range Filter Test</h2>
        <p>Test min/max price filtering</p>
        <button onclick="testPriceFilter()">Test Price Filter ($5-$15)</button>
        <div id="priceTestResult"></div>
    </div>

    <div class="test-section">
        <h2>üè∑Ô∏è Brand Filter Test</h2>
        <p>Test brand dropdown filtering</p>
        <button onclick="testBrandFilter()">Test Brand Filter (Kroger)</button>
        <div id="brandTestResult"></div>
    </div>

    <div class="test-section">
        <h2>‚≠ê Toggle Filter Test</h2>
        <p>Test On Sale and In Stock toggles</p>
        <button onclick="testToggleFilters()">Test Toggle Filters</button>
        <div id="toggleTestResult"></div>
    </div>

    <div class="test-section">
        <h2>üèÉ Quick Filter Test</h2>
        <p>Test quick filter chips</p>
        <button onclick="testQuickFilters()">Test Quick Filters</button>
        <div id="quickTestResult"></div>
    </div>

    <div class="test-section">
        <h2>üìÇ Category Filter Test</h2>
        <p>Test category filtering</p>
        <button onclick="testCategoryFilter()">Test Category Filter</button>
        <div id="categoryTestResult"></div>
    </div>

    <div class="test-section">
        <h2>üîÑ Sort Test</h2>
        <p>Test sorting options</p>
        <button onclick="testSorting()">Test Sorting</button>
        <div id="sortTestResult"></div>
    </div>

    <div class="test-section">
        <h2>üßπ Clear Filters Test</h2>
        <p>Test clearing all filters</p>
        <button onclick="testClearFilters()">Test Clear All Filters</button>
        <div id="clearTestResult"></div>
    </div>

    <div class="test-section">
        <h2>üìã Active Filter Display Test</h2>
        <p>Test active filter tags and removal</p>
        <button onclick="testActiveFilters()">Test Active Filter Display</button>
        <div id="activeTestResult"></div>
    </div>

    <script>
        // Create mock data for testing
        function setupTestData() {
            const testProducts = [
                {
                    name: "Kroger Organic Milk",
                    brand: "Kroger",
                    price: 4.99,
                    salePrice: 3.99,
                    category: "Dairy",
                    inventory: { stock: "IN_STOCK" },
                    fulfillment: { pickup: true, delivery: true }
                },
                {
                    name: "Great Value Bread",
                    brand: "Great Value",
                    price: 2.49,
                    salePrice: null,
                    category: "Bakery",
                    inventory: { stock: "OUT_OF_STOCK" },
                    fulfillment: { pickup: false, delivery: true }
                },
                {
                    name: "Organic Bananas",
                    brand: "Simple Truth",
                    price: 1.99,
                    salePrice: 1.49,
                    category: "Produce",
                    inventory: { stock: "IN_STOCK" },
                    fulfillment: { pickup: true, delivery: false }
                },
                {
                    name: "Premium Steak",
                    brand: "Private Selection",
                    price: 24.99,
                    salePrice: null,
                    category: "Meat",
                    inventory: { stock: "IN_STOCK" },
                    fulfillment: { pickup: true, delivery: true }
                },
                {
                    name: "Kroger Cheese",
                    brand: "Kroger",
                    price: 6.99,
                    salePrice: 5.99,
                    category: "Dairy",
                    inventory: { stock: "IN_STOCK" },
                    fulfillment: { pickup: true, delivery: true }
                }
            ];

            // Set up global variables that the filter functions expect
            window.allProducts = testProducts;
            window.currentProducts = [...testProducts];
            window.activeCategoryFilters = new Set();
            window.activeQuickFilters = new Set();

            updateState();
            document.getElementById('setupResult').innerHTML = '<div class="test-result pass">‚úÖ Test data created with 5 products</div>';
        }

        function updateState() {
            document.getElementById('allProductsCount').textContent = window.allProducts ? window.allProducts.length : 0;
            document.getElementById('currentProductsCount').textContent = window.currentProducts ? window.currentProducts.length : 0;
            document.getElementById('activeCategoryFilters').textContent = window.activeCategoryFilters ? Array.from(window.activeCategoryFilters).join(', ') || 'None' : 'None';
            document.getElementById('activeQuickFilters').textContent = window.activeQuickFilters ? Array.from(window.activeQuickFilters).join(', ') || 'None' : 'None';
        }

        function testPriceFilter() {
            if (!window.allProducts) {
                document.getElementById('priceTestResult').innerHTML = '<div class="test-result fail">‚ùå Please setup test data first</div>';
                return;
            }

            // Mock price filter inputs
            const mockMinPrice = { value: "5" };
            const mockMaxPrice = { value: "15" };
            
            // Test price filtering logic
            let filtered = window.allProducts.filter(product => {
                const price = (product.salePrice && product.salePrice > 0) ? product.salePrice : (product.price || 0);
                return price >= 5 && price <= 15;
            });

            const expectedCount = 1; // Only Kroger Cheese should match (sale price 5.99)
            const passed = filtered.length === expectedCount;
            
            document.getElementById('priceTestResult').innerHTML = `
                <div class="test-result ${passed ? 'pass' : 'fail'}">
                    ${passed ? '‚úÖ' : '‚ùå'} Price filter test - Expected: ${expectedCount}, Got: ${filtered.length}
                </div>
                <div class="test-result info">Filtered products: ${filtered.map(p => p.name).join(', ')}</div>
            `;
        }

        function testBrandFilter() {
            if (!window.allProducts) {
                document.getElementById('brandTestResult').innerHTML = '<div class="test-result fail">‚ùå Please setup test data first</div>';
                return;
            }

            // Test brand filtering logic
            const brandFilter = "Kroger";
            let filtered = window.allProducts.filter(product => 
                product.brand && product.brand.toLowerCase().includes(brandFilter.toLowerCase())
            );

            const expectedCount = 2; // Kroger Organic Milk and Kroger Cheese
            const passed = filtered.length === expectedCount;
            
            document.getElementById('brandTestResult').innerHTML = `
                <div class="test-result ${passed ? 'pass' : 'fail'}">
                    ${passed ? '‚úÖ' : '‚ùå'} Brand filter test - Expected: ${expectedCount}, Got: ${filtered.length}
                </div>
                <div class="test-result info">Filtered products: ${filtered.map(p => p.name).join(', ')}</div>
            `;
        }

        function testToggleFilters() {
            if (!window.allProducts) {
                document.getElementById('toggleTestResult').innerHTML = '<div class="test-result fail">‚ùå Please setup test data first</div>';
                return;
            }

            let results = [];

            // Test On Sale filter
            let onSaleFiltered = window.allProducts.filter(product => 
                product.salePrice && product.salePrice > 0 && product.salePrice < (product.price || 0)
            );
            const expectedOnSale = 3; // Milk, Bananas, Cheese
            results.push(`On Sale: ${onSaleFiltered.length === expectedOnSale ? '‚úÖ' : '‚ùå'} (${onSaleFiltered.length}/${expectedOnSale})`);

            // Test In Stock filter
            let inStockFiltered = window.allProducts.filter(product => 
                product.inventory && product.inventory.stock === 'IN_STOCK'
            );
            const expectedInStock = 4; // All except Bread
            results.push(`In Stock: ${inStockFiltered.length === expectedInStock ? '‚úÖ' : '‚ùå'} (${inStockFiltered.length}/${expectedInStock})`);

            document.getElementById('toggleTestResult').innerHTML = `
                <div class="test-result info">${results.join('<br>')}</div>
            `;
        }

        function testQuickFilters() {
            if (!window.allProducts) {
                document.getElementById('quickTestResult').innerHTML = '<div class="test-result fail">‚ùå Please setup test data first</div>';
                return;
            }

            let results = [];

            // Test Under $5 filter
            let under5 = window.allProducts.filter(product => {
                const price = (product.salePrice && product.salePrice > 0) ? product.salePrice : (product.price || 0);
                return price < 5;
            });
            results.push(`Under $5: ${under5.length} products (${under5.map(p => p.name).join(', ')})`);

            // Test Organic filter
            let organic = window.allProducts.filter(product => 
                product.name && product.name.toLowerCase().includes('organic')
            );
            results.push(`Organic: ${organic.length} products (${organic.map(p => p.name).join(', ')})`);

            // Test Deals filter
            let deals = window.allProducts.filter(product => 
                product.salePrice && product.salePrice > 0 && product.salePrice < (product.price || 0)
            );
            results.push(`Deals: ${deals.length} products (${deals.map(p => p.name).join(', ')})`);

            document.getElementById('quickTestResult').innerHTML = `
                <div class="test-result pass">‚úÖ Quick filter logic tested</div>
                <div class="test-result info">${results.join('<br>')}</div>
            `;
        }

        function testCategoryFilter() {
            if (!window.allProducts) {
                document.getElementById('categoryTestResult').innerHTML = '<div class="test-result fail">‚ùå Please setup test data first</div>';
                return;
            }

            // Get all categories
            const categories = [...new Set(window.allProducts.map(p => p.category).filter(Boolean))];
            
            // Test filtering by Dairy category
            let dairyFiltered = window.allProducts.filter(product => 
                product.category === 'Dairy'
            );
            
            const expectedDairy = 2; // Milk and Cheese
            const passed = dairyFiltered.length === expectedDairy;
            
            document.getElementById('categoryTestResult').innerHTML = `
                <div class="test-result ${passed ? 'pass' : 'fail'}">
                    ${passed ? '‚úÖ' : '‚ùå'} Category filter test (Dairy) - Expected: ${expectedDairy}, Got: ${dairyFiltered.length}
                </div>
                <div class="test-result info">Available categories: ${categories.join(', ')}</div>
                <div class="test-result info">Dairy products: ${dairyFiltered.map(p => p.name).join(', ')}</div>
            `;
        }

        function testSorting() {
            if (!window.allProducts) {
                document.getElementById('sortTestResult').innerHTML = '<div class="test-result fail">‚ùå Please setup test data first</div>';
                return;
            }

            let results = [];
            
            // Test price sorting (low to high)
            let priceLowToHigh = [...window.allProducts].sort((a, b) => {
                const aPrice = (a.salePrice && a.salePrice > 0) ? a.salePrice : (a.price || 0);
                const bPrice = (b.salePrice && b.salePrice > 0) ? b.salePrice : (b.price || 0);
                return aPrice - bPrice;
            });
            results.push(`Price Low-High: ${priceLowToHigh[0].name} ($${priceLowToHigh[0].salePrice || priceLowToHigh[0].price}) first`);

            // Test name sorting
            let nameSort = [...window.allProducts].sort((a, b) => a.name.localeCompare(b.name));
            results.push(`Name A-Z: ${nameSort[0].name} first`);

            document.getElementById('sortTestResult').innerHTML = `
                <div class="test-result pass">‚úÖ Sorting logic tested</div>
                <div class="test-result info">${results.join('<br>')}</div>
            `;
        }

        function testClearFilters() {
            // Simulate having some active filters
            window.activeCategoryFilters = new Set(['Dairy', 'Produce']);
            window.activeQuickFilters = new Set(['organic', 'deals']);
            
            updateState();
            
            // Test clearing
            window.activeCategoryFilters.clear();
            window.activeQuickFilters.clear();
            window.currentProducts = [...window.allProducts];
            
            updateState();
            
            const passed = window.activeCategoryFilters.size === 0 && 
                          window.activeQuickFilters.size === 0 && 
                          window.currentProducts.length === window.allProducts.length;
            
            document.getElementById('clearTestResult').innerHTML = `
                <div class="test-result ${passed ? 'pass' : 'fail'}">
                    ${passed ? '‚úÖ' : '‚ùå'} Clear filters test - All filters cleared and products restored
                </div>
            `;
        }

        function testActiveFilters() {
            if (!window.allProducts) {
                document.getElementById('activeTestResult').innerHTML = '<div class="test-result fail">‚ùå Please setup test data first</div>';
                return;
            }

            // Simulate some active filters
            const mockActiveFilters = [
                { label: 'Price: $5 - $15', type: 'price' },
                { label: 'Brand: Kroger', type: 'brand' },
                { label: 'On Sale', type: 'sale' },
                { label: 'Category: Dairy', type: 'category', value: 'Dairy' }
            ];

            document.getElementById('activeTestResult').innerHTML = `
                <div class="test-result pass">‚úÖ Active filter display structure ready</div>
                <div class="test-result info">Mock active filters: ${mockActiveFilters.map(f => f.label).join(', ')}</div>
                <div class="test-result info">Filter removal would call removeActiveFilter() with type and value</div>
            `;
        }

        // Initialize the test interface
        updateState();
    </script>
</body>
</html>